---
phase: 06-document-synthesis
plan: 03
type: execute
wave: 2
depends_on: ["06-01"]
files_modified:
  - src/renderers/render-03-architecture.ts
  - src/renderers/render-05-features.ts
  - src/renderers/render-06-modules.ts
  - src/renderers/render-08-environment.ts
  - src/renderers/render-09-edge-cases.ts
  - src/renderers/render-11-conventions.ts
  - src/renderers/render-13-deployment.ts
autonomous: true

must_haves:
  truths:
    - "03-ARCHITECTURE.md renderer produces architecture patterns, layering, data flow, and mermaid diagram from Round 4 data"
    - "05-FEATURES.md renderer produces end-to-end feature traces with cross-module flows and mermaid diagram from Round 3 data"
    - "06-MODULES.md renderer produces module boundaries, public APIs, and mermaid diagram from Round 2 data"
    - "08-ENVIRONMENT.md renderer produces env var documentation from Round 6 + static env data"
    - "09-EDGE-CASES.md renderer produces non-obvious behaviors from Round 5 per-module data"
    - "11-CONVENTIONS.md renderer produces team patterns and naming rules from Round 5 cross-cutting conventions"
    - "13-DEPLOYMENT.md renderer produces CI/CD and infrastructure docs from Round 6 data"
    - "Each renderer produces YAML front-matter, 2-sentence summary, and cross-references"
  artifacts:
    - path: "src/renderers/render-03-architecture.ts"
      provides: "Architecture renderer with mermaid diagram"
      exports: ["renderArchitecture"]
    - path: "src/renderers/render-05-features.ts"
      provides: "Features renderer with mermaid diagram"
      exports: ["renderFeatures"]
    - path: "src/renderers/render-06-modules.ts"
      provides: "Modules renderer with mermaid diagram"
      exports: ["renderModules"]
    - path: "src/renderers/render-08-environment.ts"
      provides: "Environment renderer"
      exports: ["renderEnvironment"]
    - path: "src/renderers/render-09-edge-cases.ts"
      provides: "Edge cases renderer"
      exports: ["renderEdgeCases"]
    - path: "src/renderers/render-11-conventions.ts"
      provides: "Conventions renderer"
      exports: ["renderConventions"]
    - path: "src/renderers/render-13-deployment.ts"
      provides: "Deployment renderer"
      exports: ["renderDeployment"]
  key_links:
    - from: "src/renderers/render-03-architecture.ts"
      to: "src/renderers/mermaid.ts"
      via: "buildArchitectureDiagram import"
      pattern: "buildArchitectureDiagram"
    - from: "src/renderers/render-05-features.ts"
      to: "src/renderers/mermaid.ts"
      via: "buildFeatureFlowDiagram import"
      pattern: "buildFeatureFlowDiagram"
    - from: "src/renderers/render-06-modules.ts"
      to: "src/renderers/mermaid.ts"
      via: "buildModuleDiagram import"
      pattern: "buildModuleDiagram"
---

<objective>
Implement 7 document renderers (batch 2): the AI-heavy documents that require significant AI round data (architecture, features, modules, environment, edge-cases, conventions, deployment).

Purpose: These documents depend heavily on AI analysis rounds (R2-R6) for their primary content. They include mermaid diagrams (architecture, features, modules) and need graceful degradation when AI rounds fail. Completing these renderers means all 14 documents have render functions.

Output: 7 renderer files (registry wiring deferred to plan 04). All 14 renderer files complete.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-document-synthesis/06-RESEARCH.md
@.planning/phases/06-document-synthesis/06-01-SUMMARY.md
@src/renderers/types.ts
@src/renderers/utils.ts
@src/renderers/mermaid.ts
@src/renderers/audience.ts
@src/renderers/registry.ts
@src/ai-rounds/schemas.ts
@src/analyzers/types.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Implement Architecture, Features, Modules, and Environment renderers</name>
  <files>src/renderers/render-03-architecture.ts, src/renderers/render-05-features.ts, src/renderers/render-06-modules.ts, src/renderers/render-08-environment.ts</files>
  <action>
    All renderers follow the established `lines.push()` pattern with shared utilities. Each exports a single function: `(ctx: RenderContext) => string`.

    **src/renderers/render-03-architecture.ts** -- `renderArchitecture(ctx: RenderContext): string`

    Primary data: R4 (architecture patterns, layering, data flow). Needs R1-R3 transitively. This is one of 4 docs with mermaid diagrams.

    Content:
    - YAML front-matter (category: 'architecture')
    - Title: `# Architecture`
    - 2-sentence summary (DOC-17): "{projectName} follows a {patternNames} architecture. This document maps patterns, layers, and data flows with concrete code evidence."
    - Section: `## Architecture Patterns` -- for each pattern in R4 patterns array: subheading with pattern name, description, confidence (always 'high' per R4 schema), evidence list (with codeRef for file paths), modules involved. Audience intro: "These are the dominant architecture patterns identified in the codebase."
    - Section: `## System Layering` -- if R4 layering exists: table with Layer, Modules, Responsibility. If not: note "No clear layering detected."
    - Section: `## Data Flow` -- for each dataFlow entry: from -> to with mechanism and data description
    - Section: `## Key Findings` -- bullet list of R4 findings
    - Section: `## Diagrams` -- buildArchitectureDiagram(ctx). Placed at END per locked decision.
    - Cross-references: link to Modules (06), Features (05), File Structure (04)
    - If no R4 data: skip generation entirely (per research: "No meaningful static content for architecture"). Return empty string and let the caller handle it.
    - If audience === 'ai': structuredBlock per pattern

    **src/renderers/render-05-features.ts** -- `renderFeatures(ctx: RenderContext): string`

    Primary data: R3 (features, cross-module flows). One of 4 docs with mermaid diagrams.

    Content:
    - YAML front-matter (category: 'features')
    - Title: `# Features`
    - 2-sentence summary: "{projectName} exposes {N} user-facing features. This document traces each feature end-to-end from entry point through implementation."
    - Section: `## User-Facing Features` -- for each feature where userFacing === true: subheading with name, description, entry point (codeRef), modules involved, files (codeRef list)
    - Section: `## Internal Features` -- for each feature where userFacing === false: same format
    - Section: `## Cross-Module Flows` -- for each crossModuleFlow: name, description, path (as flow diagram in text: `A -> B -> C`)
    - Section: `## Diagrams` -- buildFeatureFlowDiagram(ctx). Placed at END.
    - Cross-references: link to Modules (06), Architecture (03)
    - If no R3 data: skip generation (return empty string). Features cannot be meaningfully determined from static analysis alone.

    **src/renderers/render-06-modules.ts** -- `renderModules(ctx: RenderContext): string`

    Primary data: R2 (modules, relationships). One of 4 docs with mermaid diagrams.

    Content:
    - YAML front-matter (category: 'modules')
    - Title: `# Modules`
    - 2-sentence summary: "{projectName} is organized into {N} modules. This document describes each module's boundary, public API, and purpose."
    - Section: `## Module Overview` -- table: Name, Path (codeRef), Purpose, Files Count
    - Section: `## Module Details` -- for each module: `### {name}` subheading, purpose, path (codeRef), public API (bullet list), files (codeRef list), concerns (if any)
    - Section: `## Module Relationships` -- table: From, To, Type, Evidence. Or bullet list if fewer entries.
    - Section: `## Boundary Issues` -- bullet list of boundaryIssues from R2
    - Section: `## Diagrams` -- buildModuleDiagram(ctx). Placed at END.
    - Cross-references: link to Architecture (03), Features (05), File Structure (04)
    - If no R2 data: partial render from static file tree (group top-level directories as modules). Add warning banner.

    **src/renderers/render-08-environment.ts** -- `renderEnvironment(ctx: RenderContext): string`

    Primary data: R6 (env vars with purpose) + static env data. Can render static-only.

    Content:
    - YAML front-matter (category: 'environment')
    - Title: `# Environment`
    - 2-sentence summary: "{projectName} uses {N} environment variables for configuration. This document explains every variable, its purpose, and where it's required."
    - Section: `## Environment Files` -- list .env files found (from static env.envFiles), each with codeRef
    - Section: `## Environment Variables` -- table: Name, Purpose (from R6), Required (from R6), Source. If no R6: show variable name + reference location from static analysis.
    - Section: `## Variable References` -- table: File (codeRef), Line, Variable. Cap at 50 rows (consistent with report.ts pattern).
    - Section: `## Warnings` -- any env warnings from static analysis
    - Cross-references: link to Getting Started (02), Deployment (13)
    - If no R6 data: render from static env data with warning banner. Static env data is sufficient for basic documentation.

  </action>
  <verify>
    Run `npx tsc --noEmit` to verify no type errors.

    Run `npx tsx --eval "import { renderArchitecture } from './src/renderers/render-03-architecture.js'; import { renderModules } from './src/renderers/render-06-modules.js'; console.log(typeof renderArchitecture, typeof renderModules)"` -- should output 'function function'.
  </verify>
  <done>
    Architecture renderer produces patterns, layering, data flow with mermaid diagram from R4 data. Features renderer produces end-to-end feature traces with mermaid diagram from R3 data. Modules renderer produces module boundaries and public APIs with mermaid diagram from R2 data. Environment renderer produces env var documentation from R6 + static env data. All include YAML front-matter, 2-sentence summaries, cross-references, and graceful AI-missing fallback.
  </done>
</task>

<task type="auto">
  <name>Task 2: Implement Edge Cases, Conventions, and Deployment renderers</name>
  <files>src/renderers/render-09-edge-cases.ts, src/renderers/render-11-conventions.ts, src/renderers/render-13-deployment.ts</files>
  <action>
    **src/renderers/render-09-edge-cases.ts** -- `renderEdgeCases(ctx: RenderContext): string`

    Primary data: R5 modules' edge cases per module. Partial static fallback from todos.

    Content:
    - YAML front-matter (category: 'edge-cases')
    - Title: `# Edge Cases & Gotchas`
    - 2-sentence summary: "{projectName} has {N} documented edge cases across {M} modules. This document catalogs non-obvious behaviors, error-prone areas, and gotchas."
    - Section: `## Summary` -- table: Severity, Count (aggregate from R5 modules)
    - Section: `## By Module` -- for each module in R5.modules: `### {moduleName}` subheading, then table: Description, File (codeRef), Line, Severity, Evidence. Sort by severity (critical first).
    - Section: `## Error Handling Patterns` -- for each module: strategy description, gaps, patterns
    - Section: `## Key Findings` -- bullet list of R5 findings
    - Cross-references: link to Tech Debt (10), Conventions (11), Testing (12)
    - If no R5 data: partial render from static todos (filter for 'bugs' and 'debt' categories). Add warning banner.

    **src/renderers/render-11-conventions.ts** -- `renderConventions(ctx: RenderContext): string`

    Primary data: R5 cross-cutting conventions + per-module conventions. No meaningful static fallback.

    Content:
    - YAML front-matter (category: 'conventions')
    - Title: `# Conventions`
    - 2-sentence summary: "{projectName} follows {N} cross-cutting conventions. This document catalogs team patterns, naming rules, and code organization standards."
    - Section: `## Cross-Cutting Conventions` -- for each convention in R5.crossCuttingConventions: pattern name, description, frequency (how often detected)
    - Section: `## Per-Module Conventions` -- for each module in R5.modules that has conventions: `### {moduleName}` subheading, then for each convention: pattern, description, examples (codeRef for file paths in examples)
    - Cross-references: link to Architecture (03), Modules (06), Testing (12)
    - If no R5 data: skip generation (return empty string). Conventions cannot be meaningfully determined from static analysis alone. Per research recommendation: "skip generation entirely if there's genuinely nothing useful to show."

    **src/renderers/render-13-deployment.ts** -- `renderDeployment(ctx: RenderContext): string`

    Primary data: R6 (deployment platform, CI, infrastructure, build process). Partial static fallback.

    Content:
    - YAML front-matter (category: 'deployment')
    - Title: `# Deployment`
    - 2-sentence summary: "{projectName} deploys via {platform/CI}. This document covers CI/CD pipelines, infrastructure, environments, and build processes."
    - Section: `## Deployment Platform` -- platform, containerized flag, CI provider, evidence (codeRef for evidence paths)
    - Section: `## Build Process` -- commands list, artifacts list, scripts table (script name: command)
    - Section: `## Infrastructure` -- table: Service, Purpose, Evidence (codeRef)
    - Section: `## Environment Variables` -- cross-ref to Environment (08) for full details, brief list of deployment-critical vars from R6.envVars
    - Section: `## Key Findings` -- bullet list of R6 findings
    - Cross-references: link to Environment (08), Getting Started (02), Dependencies (07)
    - If no R6 data: partial render from static analysis (detect CI files in file tree, build scripts from package.json, Dockerfile presence). Add warning banner.

    NOTE: Registry wiring for these 7 renderers is handled in plan 04 (Wave 3) to avoid parallel write conflicts with plan 02.

  </action>
  <verify>
    Run `npx tsc --noEmit` to verify no type errors.

    Run `npx tsx --eval "import { renderEdgeCases } from './src/renderers/render-09-edge-cases.js'; import { renderConventions } from './src/renderers/render-11-conventions.js'; import { renderDeployment } from './src/renderers/render-13-deployment.js'; console.log(typeof renderEdgeCases, typeof renderConventions, typeof renderDeployment)"` -- should output 'function function function'.
  </verify>
  <done>
    Edge Cases renderer produces per-module edge case catalog from R5 data. Conventions renderer produces cross-cutting and per-module patterns from R5 data. Deployment renderer produces CI/CD and infrastructure docs from R6 data. All 3 renderer files created and export their render functions.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with no errors
2. All 7 renderer files exist in src/renderers/
3. Each renderer exports a single function returning string
4. Renderers for docs 03, 05, 06 include mermaid diagram section calls
5. Renderers for docs 03, 05, 11 return empty string when primary AI round unavailable
6. All 7 render functions importable from their respective files
7. Each renderer includes YAML front-matter, 2-sentence summary, cross-references
</verification>

<success_criteria>
Batch 2 of document renderers is complete: all 7 AI-heavy documents (architecture, features, modules, environment, edge-cases, conventions, deployment) have render functions. Combined with plan 02, all 14 renderer files exist. Registry wiring is deferred to plan 04. The mermaid diagrams are placed in dedicated "Diagrams" sections at the end of applicable documents. Graceful degradation handles missing AI rounds.
</success_criteria>

<output>
After completion, create `.planning/phases/06-document-synthesis/06-03-SUMMARY.md`
</output>

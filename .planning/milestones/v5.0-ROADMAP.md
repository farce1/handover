# Milestone v5.0: Remote & Advanced MCP

**Status:** âœ… SHIPPED 2026-02-26
**Phases:** 16-20
**Total Plans:** 12

## Overview

v5.0 shipped remote-ready MCP capabilities while preserving stdio-first compatibility for existing local workflows. The milestone added resumable streaming QA, deterministic remote regeneration jobs, transport parity across stdio and HTTP, local embedding routing controls, and HTTP security guardrails for non-local deployments.

## Phases

### Phase 16: Streaming QA Session Lifecycle

**Goal**: Users can run long QA queries with streamed progress, cancellation, and safe resume behavior without losing response structure.
**Depends on**: Phase 15
**Plans**: 2 plans

Plans:

- [x] 16-01: Build durable QA streaming session core (event schema, append-only store, replay-safe manager)
- [x] 16-02: Expose MCP streaming QA lifecycle tools (progress, cancellation, reconnect resume)

**Details:**

- Added canonical lifecycle event schemas and durable append-only session persistence.
- Implemented deterministic replay cursors and single terminal transition guardrails.
- Exposed MCP lifecycle tools (`qa_stream_start/status/resume/cancel`) with progress notifications and resume remediation.

### Phase 17: Local Embedding Provider Routing

**Goal**: Users can choose local embedding execution with predictable routing and validation before indexing or retrieval.
**Depends on**: Phase 15
**Plans**: 4 plans

Plans:

- [x] 17-01: Build embedding locality config, local provider router, and shared health-check primitives
- [x] 17-02: Wire mode-aware routing and fail-fast compatibility validation into reindex and retrieval
- [x] 17-03: Expose embedding health command, CLI mode overrides, and mode/provider run summaries
- [x] 17-04: Close reindex route visibility gap with runtime route metadata in results

**Details:**

- Added locality modes (`local-only`, `local-preferred`, `remote-only`) and Ollama-compatible local embedding support.
- Routed reindex/retrieval through shared deterministic provider selection with strict metadata mismatch blocking.
- Added `handover embedding-health` with structured diagnostics and per-run mode overrides.
- Ensured reindex output always reports runtime-resolved mode/provider across all result paths.

### Phase 18: Remote Regeneration Job Control

**Goal**: Users can trigger and monitor remote documentation regeneration safely through MCP with deterministic lifecycle behavior.
**Depends on**: Phase 16
**Plans**: 2 plans

Plans:

- [x] 18-01: Build deterministic regeneration job core (contracts, target normalization, durable store, single-flight manager)
- [x] 18-02: Expose regenerate_docs MCP trigger/status tools with shared executor wiring and remote usage docs

**Details:**

- Added durable regeneration job schema/store with legal transition enforcement.
- Implemented target-key single-flight dedupe semantics for duplicate trigger requests.
- Exposed deterministic MCP trigger/status tools with structured error guidance.

### Phase 19: HTTP Transport Parity

**Goal**: Users can run MCP over optional Streamable HTTP with the same functional behavior they get from stdio.
**Depends on**: Phase 18
**Plans**: 2 plans

Plans:

- [x] 19-01: Config schema extension, CLI flags, and serve transport branching
- [x] 19-02: HTTP transport server implementation and docs update

**Details:**

- Added transport-aware serve configuration and CLI overrides while keeping stdio default.
- Implemented Streamable HTTP transport with canonical POST/GET/DELETE path routing.
- Added structured unknown-path remediation responses and user setup guidance.

### Phase 20: HTTP Security and Access Controls

**Goal**: Users can deploy HTTP MCP endpoints with explicit origin and authentication controls that protect remote usage.
**Depends on**: Phase 19
**Plans**: 2 plans

Plans:

- [x] 20-01: Config schema extension, security middleware (origin policy + bearer auth), and startup guard
- [x] 20-02: CLI `--allow-origin` flag, serve startup wiring, middleware insertion, and security docs

**Details:**

- Added origin policy middleware with strict default deny for cross-origin requests.
- Added bearer token middleware with timing-safe token verification and structured auth diagnostics.
- Added startup guard that blocks non-loopback HTTP binds without configured auth.
- Wired security middleware into HTTP server startup and documented secure deployment/troubleshooting flows.

---

## Milestone Summary

**Decimal Phases:**

- None

**Key Decisions:**

- Kept stdio as default transport and made HTTP opt-in to preserve backward compatibility.
- Persisted QA stream events before publication so replay and live updates share one source of truth.
- Enforced explicit locality routing policy for embeddings with deterministic fallback behavior.
- Used target-key single-flight orchestration for regeneration dedupe.
- Denied cross-origin requests by default and required auth token for non-loopback HTTP binds.

**Issues Resolved:**

- Delivered streaming QA lifecycle with cancellation and resume semantics.
- Added deterministic remote regeneration control and status polling contracts.
- Closed transport parity gap by shipping Streamable HTTP with stdio-equivalent capability surface.
- Closed HTTP security wiring gap with startup checks, middleware, CLI overrides, and docs.

**Issues Deferred:**

- Runtime human validation for selected streaming/embedding/regeneration flows remains deferred.
- Phase 19 lacks a standalone `19-VERIFICATION.md` artifact despite integration checks passing.

**Technical Debt Incurred:**

- 7 tech-debt items recorded in milestone audit (`.planning/milestones/v5.0-MILESTONE-AUDIT.md`), mostly human runtime validation follow-ups.

---

_For current project status, see `.planning/ROADMAP.md`._

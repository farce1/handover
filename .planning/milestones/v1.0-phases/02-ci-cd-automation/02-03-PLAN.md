---
phase: 02-ci-cd-automation
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - eslint.config.js
  - prettier.config.js
  - commitlint.config.js
  - .husky/pre-commit
  - .husky/commit-msg
  - .github/dependabot.yml
  - .prettierignore
autonomous: true

must_haves:
  truths:
    - 'Pre-commit hook auto-fixes ESLint and Prettier issues on staged files'
    - "Commit-msg hook rejects commits that don't follow conventional commits format"
    - 'ESLint flat config works with TypeScript and defers formatting to Prettier'
    - 'Prettier formats the entire codebase with consistent style'
    - 'Dependabot opens weekly grouped PRs for production and dev dependencies separately'
  artifacts:
    - path: 'eslint.config.js'
      provides: 'ESLint flat config for TypeScript with Prettier compat'
      contains: 'tseslint'
    - path: 'prettier.config.js'
      provides: 'Prettier config with standard settings'
      contains: 'singleQuote'
    - path: 'commitlint.config.js'
      provides: 'Commitlint config extending conventional commits'
      contains: 'config-conventional'
    - path: '.husky/pre-commit'
      provides: 'Pre-commit hook running lint-staged'
      contains: 'lint-staged'
    - path: '.husky/commit-msg'
      provides: 'Commit-msg hook running commitlint'
      contains: 'commitlint'
    - path: '.github/dependabot.yml'
      provides: 'Dependabot config for npm and GitHub Actions ecosystems'
      contains: 'weekly'
    - path: 'package.json'
      provides: 'Updated scripts, lint-staged config, devDependencies'
      contains: 'lint-staged'
  key_links:
    - from: '.husky/pre-commit'
      to: 'package.json'
      via: 'lint-staged config in package.json'
      pattern: 'lint-staged'
    - from: 'eslint.config.js'
      to: 'prettier.config.js'
      via: 'eslint-config-prettier disables conflicting rules'
      pattern: 'eslintConfigPrettier'
---

<objective>
Set up DX tooling: ESLint, Prettier, commitlint, husky pre-commit hooks, lint-staged, and Dependabot configuration.

Purpose: Enforce code quality and commit conventions automatically. Pre-commit hooks auto-fix style issues so contributors never argue about formatting. Commitlint ensures conventional commits for release-please changelog generation. Dependabot keeps dependencies current with minimal maintainer effort.

Output: Config files for ESLint, Prettier, commitlint; husky hooks; Dependabot config; updated package.json with scripts and dependencies
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@package.json
@vitest.config.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install DX dependencies and configure ESLint + Prettier</name>
  <files>package.json, eslint.config.js, prettier.config.js, .prettierignore</files>
  <action>
**Step 1: Install all DX devDependencies:**
```bash
npm install --save-dev eslint typescript-eslint eslint-config-prettier prettier husky lint-staged @commitlint/cli @commitlint/config-conventional
```

**Step 2: Create `eslint.config.js`** (flat config, ESM — project has `"type": "module"`):

```javascript
import tseslint from 'typescript-eslint';
import eslintConfigPrettier from 'eslint-config-prettier';

export default tseslint.config(...tseslint.configs.recommended, eslintConfigPrettier, {
  ignores: ['dist/**', 'node_modules/**', 'coverage/**'],
});
```

Using flat config (`eslint.config.js`) because ESLint 9 removed legacy `.eslintrc` format. The project uses ESM (`"type": "module"`) so `.js` extension is correct.

`eslint-config-prettier` disables all ESLint rules that conflict with Prettier — keeps Prettier as the single source of truth for formatting.

**Step 3: Create `prettier.config.js`:**

```javascript
export default {
  semi: true,
  singleQuote: true,
  trailingComma: 'all',
  printWidth: 100,
  tabWidth: 2,
};
```

Standard community defaults. `printWidth: 100` gives slightly more room than the 80-char default, which works well for TypeScript's verbose type annotations.

**Step 4: Create `.prettierignore`:**

```
dist
coverage
node_modules
*.tsbuildinfo
CHANGELOG.md
.release-please-manifest.json
pnpm-lock.yaml
package-lock.json
```

`CHANGELOG.md` and `.release-please-manifest.json` are managed by release-please — Prettier should not reformat them.

**Step 5: Update `package.json` scripts:**

- Add `"lint": "eslint src --max-warnings 0"` (replace any existing lint stub)
- Add `"lint:fix": "eslint src --fix"`
- Add `"format": "prettier --write ."`
- Add `"format:check": "prettier --check ."`
- Add `"prepare": "husky"` (required for husky v9 — runs on npm install)

**Step 6: Add `lint-staged` config to `package.json`:**

```json
{
  "lint-staged": {
    "*.{ts,js}": ["eslint --fix", "prettier --write"],
    "*.{json,md,yml,yaml}": ["prettier --write"]
  }
}
```

**Step 7: Run Prettier on entire codebase:**

```bash
npx prettier --write .
```

This is a one-time format pass to bring the codebase into compliance. Per user decision: "format entire codebase."
</action>
<verify>

1. `npx eslint src --max-warnings 0` — passes with no errors or warnings
2. `npx prettier --check .` — all files formatted
3. `npm run lint` — script exists and passes
4. `npm run format:check` — script exists and passes
5. Check `package.json` has all new devDependencies and lint-staged config
   </verify>
   <done>ESLint flat config for TypeScript with Prettier compat is active. Prettier config with standard settings is in place. Entire codebase formatted. lint and format scripts work. lint-staged config in package.json targets TS/JS with ESLint+Prettier and other files with Prettier only.</done>
   </task>

<task type="auto">
  <name>Task 2: Set up husky hooks, commitlint, and Dependabot</name>
  <files>.husky/pre-commit, .husky/commit-msg, commitlint.config.js, .github/dependabot.yml</files>
  <action>
**Step 1: Initialize husky:**
```bash
npx husky init
```

This creates `.husky/` directory and adds `"prepare": "husky"` to package.json (if not already there from Task 1).

**Step 2: Configure pre-commit hook:**
Write `.husky/pre-commit`:

```bash
npx lint-staged
```

This runs ESLint --fix and Prettier --write on staged files only. Auto-corrects issues before commit.

**Step 3: Configure commit-msg hook:**
Write `.husky/commit-msg`:

```bash
npx --no -- commitlint --edit $1
```

This validates the commit message against conventional commits format. Rejects non-conforming messages with a clear error.

**Step 4: Create `commitlint.config.js`:**

```javascript
export default { extends: ['@commitlint/config-conventional'] };
```

Using ESM export (project has `"type": "module"`).

**Step 5: Create `.github/dependabot.yml`:**

```yaml
version: 2
updates:
  - package-ecosystem: npm
    directory: /
    schedule:
      interval: weekly
      day: monday
    groups:
      production-deps:
        dependency-type: production
      dev-deps:
        dependency-type: development
  - package-ecosystem: github-actions
    directory: /
    schedule:
      interval: weekly
      day: monday
```

Two ecosystems: npm (grouped by production vs dev) and github-actions. Weekly on Monday. Groups reduce PR noise — one PR for all production dep bumps, one for all dev dep bumps.

**Step 6: Verify hooks work:**

```bash
echo "bad message" | npx commitlint
```

Should fail (not conventional commit format).

```bash
echo "feat: test message" | npx commitlint
```

Should pass.
</action>
<verify>

1. `.husky/pre-commit` exists and contains `npx lint-staged`
2. `.husky/commit-msg` exists and contains `commitlint`
3. `echo "bad" | npx commitlint` fails
4. `echo "feat: valid" | npx commitlint` passes
5. `.github/dependabot.yml` exists with npm and github-actions ecosystems
6. `commitlint.config.js` exists with conventional config
   </verify>
   <done>Husky pre-commit hook runs lint-staged (ESLint fix + Prettier) on staged files. Commit-msg hook enforces conventional commits via commitlint. Dependabot configured for weekly grouped PRs on npm and GitHub Actions ecosystems.</done>
   </task>

</tasks>

<verification>
1. `npx eslint src --max-warnings 0` passes
2. `npx prettier --check .` reports all files formatted
3. `echo "bad" | npx commitlint` fails; `echo "feat: valid" | npx commitlint` passes
4. `.husky/pre-commit` and `.husky/commit-msg` exist with correct content
5. `.github/dependabot.yml` has npm + github-actions with weekly grouped schedule
6. `package.json` has all DX devDependencies, lint-staged config, and updated scripts
</verification>

<success_criteria>

- ESLint flat config (eslint.config.js) works with TypeScript and defers formatting to Prettier
- Prettier config with standard settings; entire codebase formatted
- Husky pre-commit hook auto-fixes staged files via lint-staged
- Husky commit-msg hook enforces conventional commits via commitlint
- Dependabot opens weekly grouped PRs for npm and GitHub Actions
- All configs use ESM exports (project has "type": "module")
  </success_criteria>

<output>
After completion, create `.planning/phases/02-ci-cd-automation/02-03-SUMMARY.md`
</output>

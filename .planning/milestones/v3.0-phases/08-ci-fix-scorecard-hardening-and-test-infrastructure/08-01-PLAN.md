---
phase: 08-ci-fix-scorecard-hardening-and-test-infrastructure
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/ai-rounds/runner.ts
  - package.json
  - package-lock.json
autonomous: true

must_haves:
  truths:
    - '`npm run typecheck` passes on main with zero errors'
    - '`npm test` exits 0 on main (no coverage threshold failures)'
    - 'All 5 Dependabot PRs are merged and closed'
    - 'All 0.x dependencies in package.json use exact versions (no ^ or ~ prefix)'
  artifacts:
    - path: 'src/ai-rounds/runner.ts'
      provides: 'Missing ValidationResult import'
      contains: "import type { ValidationResult } from './types.js'"
    - path: 'package.json'
      provides: 'Exact-pinned 0.x dependency versions'
  key_links:
    - from: 'src/ai-rounds/runner.ts'
      to: 'src/ai-rounds/types.ts'
      via: 'type import'
      pattern: 'import type.*ValidationResult.*from.*types'
---

<objective>
Fix the TypeScript CI error on main (missing `ValidationResult` import), merge all 5 open Dependabot PRs, then pin 0.x dependency versions to exact values to prevent future breaking minor updates.

Purpose: Unblock CI so subsequent plans can rely on a green main branch. Merge blocked dependency updates and tighten version constraints for supply chain safety.
Output: Green CI on main, all Dependabot PRs merged, 0.x deps pinned to exact versions.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-ci-fix-scorecard-hardening-and-test-infrastructure/08-RESEARCH.md
@src/ai-rounds/runner.ts
@src/ai-rounds/types.ts
@package.json
@vitest.config.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix TypeScript error and remove coverage thresholds</name>
  <files>src/ai-rounds/runner.ts, vitest.config.ts</files>
  <action>
1. In `src/ai-rounds/runner.ts`, add the missing import on line 5 (after the existing `RoundExecutionResult` import):
   ```typescript
   import type { RoundExecutionResult, ValidationResult } from './types.js';
   ```
   Remove the separate `import type { RoundExecutionResult } from './types.js';` line and combine into a single import statement from `'./types.js'`.

2. In `vitest.config.ts`, remove the `thresholds` block entirely (lines 15-20) â€” no coverage threshold until Phase 11. Also remove `'tests/**/*.test.ts'` from the `include` array (tests are colocated at `src/**/*.test.ts` per project convention). The updated config should be:

   ```typescript
   import { defineConfig } from 'vitest/config';

   export default defineConfig({
     test: {
       globals: true,
       environment: 'node',
       include: ['src/**/*.test.ts'],
       exclude: ['node_modules', 'dist', '.claude', '.planning'],
       testTimeout: 120_000,
       coverage: {
         provider: 'v8',
         reporter: ['text', 'lcov'],
         include: ['src/**/*.ts'],
         exclude: ['src/**/*.test.ts', 'src/**/*.spec.ts'],
       },
     },
   });
   ```

3. Run `npm run typecheck` to confirm zero TypeScript errors.
4. Run `npm test` to confirm it exits 0 (no threshold failures with zero test files).
5. Commit both fixes to main: `fix(ci): add missing ValidationResult import and remove premature coverage thresholds`
   </action>
   <verify>

- `npm run typecheck` exits 0
- `npm test` exits 0
- `git log --oneline -1` shows the fix commit on main
  </verify>
  <done>TypeScript compiles cleanly and test runner succeeds on main with no coverage threshold failures.</done>
  </task>

<task type="auto">
  <name>Task 2: Merge all 5 Dependabot PRs and pin 0.x versions</name>
  <files>package.json, package-lock.json</files>
  <action>
1. List open Dependabot PRs: `gh pr list --author 'dependabot[bot]' --state open`

2. Merge all 5 PRs in this order (GitHub Actions PRs first, then npm PRs per research guidance):
   - PR #1: actions/checkout v4 to v6
   - PR #2: actions/setup-node v4 to v6
   - PR #3: actions/upload-artifact v4 to v6
   - PR #4: production dependencies (@anthropic-ai/sdk, openai, commander)
   - PR #5: dev dependencies (vitest, @vitest/coverage-v8, etc.)

   For each PR: `gh pr merge <number> --squash --admin` (admin bypass needed since branch protection is not yet enabled).

3. After all merges, pull main locally: `git pull origin main`

4. Run `npm run typecheck` to check for breakage from dependency upgrades. If TypeScript errors appear in `src/providers/anthropic.ts` or `src/providers/openai-compat.ts`, investigate and fix the SDK-breaking changes before continuing.

5. Run `npm test` to confirm tests still pass.

6. Pin all 0.x dependencies to exact versions in `package.json`. Identify every dependency (both `dependencies` and `devDependencies`) where the version starts with `^0.` or `~0.` and replace with the exact installed version (no caret, no tilde). The known 0.x packages are:
   - `@anthropic-ai/sdk`: change from `^0.x.x` to exact version (e.g., `"0.76.0"`)
   - `@clack/prompts`: change from `^0.10.0` to exact installed version
   - `web-tree-sitter`: change from `^0.x.x` to exact installed version
   - `tree-sitter-wasms`: change from `^0.1.13` to exact installed version

   Use `npm ls <package> --depth=0` to find the exact installed version for each.

7. Run `npm install` to update the lockfile with exact versions.
8. Run `npm run typecheck && npm test` again to confirm nothing broke.
9. Commit: `fix(deps): pin 0.x dependencies to exact versions to prevent breaking minor updates`
   </action>
   <verify>

- `gh pr list --author 'dependabot[bot]' --state open` returns no results
- `npm run typecheck` exits 0
- `npm test` exits 0
- `grep -E '"[~^]0\.' package.json` returns no matches (no unpinned 0.x versions)
  </verify>
  <done>All 5 Dependabot PRs merged, CI green after merges, all 0.x deps pinned to exact versions.</done>
  </task>

</tasks>

<verification>
- `npm run typecheck` exits 0 on main
- `npm test` exits 0 on main
- No open Dependabot PRs on the repository
- All 0.x package versions in package.json are exact (no ^ or ~ prefix on 0.x versions)
- Git log shows both fix commits on main
</verification>

<success_criteria>
CI passes on main without errors. All 5 Dependabot PRs are closed/merged. Zero 0.x dependencies have caret or tilde version ranges.
</success_criteria>

<output>
After completion, create `.planning/phases/08-ci-fix-scorecard-hardening-and-test-infrastructure/08-01-SUMMARY.md`
</output>
